var Y=Object.defineProperty,K=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var N=(t,n,e)=>n in t?Y(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,$=(t,n)=>{for(var e in n||(n={}))q.call(n,e)&&N(t,e,n[e]);if(M)for(var e of M(n))H.call(n,e)&&N(t,e,n[e]);return t},G=(t,n)=>K(t,W(n));import{_ as J,d as R,c as U,o as x,a as g,n as D,u as c,t as Q,r as A,b as X,e as Z,f as ee,w as te,g as m,F as I,h as S,i as ne,m as le,j,k as se,l as ie,p as O}from"./assets/index.e37cabf0.js";import{c as V}from"./utils.0eff9dc5.js";const re=["textContent"],ae=R({props:{x:null,y:null,value:null,mergeIndex:null},setup(t){const n=t,e=U(()=>`
  --hue: ${Math.log2(n.value)*18};
  --x: ${n.x};
  --y: ${n.y};
  `);return(i,l)=>(x(),g("div",{class:"tile",style:D(c(e)),textContent:Q(t.value)},null,12,re))}});var oe=J(ae,[["__scopeId","data-v-7e0dc0d3"]]);const v=A(!1),_=A(!1),h=A(!1);function L(t){return{cell:V(t),tile:V(t)}}let b,C=0,w=2048;function P(t){const n=t.cells.filter(l=>l.tileIndex===null);if(n.length===0)return!1;const e=n[Math.floor(b.cell()*n.length)],i={x:e.x,y:e.y,value:b.tile()>.5?2:4,mergeIndex:null};return e.tileIndex=C++,t.tiles[e.tileIndex]=i,!0}function F(t){const n={cells:Array.from({length:t*t}).map((i,l)=>({index:l,x:l%t,y:Math.floor(l/t),tileIndex:null})),tiles:{}};let e=0;for(;e++<2;)P(n);return n}function T(t){return t.cells.reduce((n,e)=>(n[e.x]=n[e.x]||[],n[e.x][e.y]=e.index,n),[])}function E(t){return t.cells.reduce((n,e)=>(n[e.y]=n[e.y]||[],n[e.y][e.x]=e.index,n),[])}function k(t,n){let e=0;const i=(l,s)=>{var r,o,d;return!(s.tileIndex!==null&&((r=t.tiles[s.tileIndex])==null?void 0:r.mergeIndex)!==null||s.tileIndex!==null&&((o=t.tiles[s.tileIndex])==null?void 0:o.value)!==((d=t.tiles[l.tileIndex])==null?void 0:d.value))};return n.forEach(l=>{for(let s=1;s<l.length;s++){const r=t.cells[l[s]];let o=null;if(r.tileIndex!==null){for(let d=s-1;d>=0;d--){const p=t.cells[l[d]];if(!i(r,p))break;o=p}o&&(o.tileIndex!==null?t.tiles[o.tileIndex].mergeIndex=r.tileIndex:o.tileIndex=r.tileIndex,t.tiles[r.tileIndex].x=o.x,t.tiles[r.tileIndex].y=o.y,r.tileIndex=null,e++)}}}),e}function ue(t){t.cells.filter(n=>n.tileIndex!==null).forEach(n=>{const e=t.tiles[n.tileIndex];e.mergeIndex!==null&&(e.value+=t.tiles[e.mergeIndex].value,delete t.tiles[e.mergeIndex],e.mergeIndex=null),e.value>=w&&(_.value=!0)})}function z(t){const n=l=>{var s;return t.tiles[((s=t.cells[l])==null?void 0:s.tileIndex)||-1]},e=l=>l.some(s=>s.some((r,o)=>{const d=n(r),p=n(s[o-1]),a=n(s[o+1]);return(d==null?void 0:d.value)===(p==null?void 0:p.value)||(d==null?void 0:d.value)===(a==null?void 0:a.value)}));if(t.cells.some(l=>l.tileIndex===null))return!0;let i=e(T(t));return i=i||e(E(t)),i}function ce(t){const{size:n,seed:e}=c(t);b=L(e);const i=X("2048-state",{options:$({target:w},c(t)),board:F(n)});C=Object.keys(i.value.board.tiles).map(r=>+r).reduce((r,o)=>(o>r?o:r)+1);const{options:l}=c(i);return l.seed!==e&&(b=L(c(i).options.seed)),w=l.target||w,{state:i,reset:()=>{C=0,i.value=G($({},c(i)),{board:F(c(i).options.size)}),v.value=!1,_.value=!1,h.value=!1}}}const de={relative:"","p-6":"","text-center":"","select-none":""},fe=m("span",null,"GAME OVER",-1),ve=m("span",{text:"orange-400 dark:yellow-400"},"YOU WIN",-1),xe=R({props:{state:null},emits:["reset"],setup(t,{emit:n}){const e=t,i=U(()=>{const{size:a}=e.state.options,u=Z.lg.value?.5:1,f=(a>4?1:2)*u,y=Math.ceil((90-f*(a+1))*u/a);return`
  --font-size: ${Math.floor(y*10/3)/10}vmin;
  --grid-size: repeat(${a}, ${y}vmin);
  --grid-gap: ${f}vmin;
  --cell-size: ${y}vmin;
  font-size: var(--font-size);
  border-width: var(--grid-gap);
  `});let l=0;ee(()=>{const{board:a,options:u}=e.state;v.value=!z(a),_.value=!v.value&&Object.keys(a.tiles).some(f=>a.tiles[+f].value>=u.target),v.value||_.value&&!h.value||s()}),te([v,_],(a,u)=>{if(u[0]===!0||u[1]===!0)return s()});function s(){window.addEventListener("keydown",r,{once:!0})}function r(a){const{board:u}=e.state;switch(a.key){case"ArrowUp":l=k(u,T(u));break;case"ArrowDown":l=k(u,T(u).map(f=>f.reverse()));break;case"ArrowLeft":l=k(u,E(u));break;case"ArrowRight":l=k(u,E(u).map(f=>f.reverse()));break}l===0&&z(u)&&s()}function o(){const{board:a}=e.state;l&&--l===0&&(ue(a),P(a),z(a)?(!_.value||h.value)&&s():v.value=!0)}function d(){v.value=!1,n("reset")}function p(){h.value=!0,s()}return(a,u)=>{const f=oe;return x(),g("div",de,[m("div",{relative:"","rounded-xl":"","inline-grid":"",grid:"rows-$grid-size cols-$grid-size gap-$grid-gap",leading:"$cell-size",bg:"gray-500/10",border:"transparent solid","children:rounded":"$grid-gap","children:w":"$cell-size","children:h":"$cell-size",style:D(c(i)),onTransitionend:o},[(x(!0),g(I,null,S(t.state.board.cells,y=>(x(),g("div",{key:y.index,bg:"gray-500/10"}))),128)),(x(!0),g(I,null,S(t.state.board.tiles,(y,B)=>(x(),ne(f,le({key:B},y),null,16))),128))],36),m("div",{absolute:"","top-0":"","left-0":"","w-full":"","h-full":"","bg-transparent":"",transition:"","duration-1000":"",flex:"~ col","justify-center":"","items-center":"",text:"10vmin",class:se(c(v)||c(_)&&!c(h)?"z-10 bg-white/80 dark:bg-black/80":"-z-100 opacity-0")},[c(v)?(x(),g(I,{key:0},[fe,m("button",{btn:"",text:"3vmin",onClick:d}," REPLAY ")],64)):j("",!0),c(_)&&!c(h)?(x(),g(I,{key:1},[ve,m("button",{btn:"~ orange dark:yellow",text:"3vmin",onClick:p}," CONTINUE ")],64)):j("",!0)],2)])}}}),me={"pb-4":""},pe=m("h2",{text:"5xl center ellipsis",leading:"2em","overflow-hidden":""}," 2048 ",-1),ge={"text-center":""},_e=R({setup(t){const{state:n,reset:e}=ce({size:4});return(i,l)=>{const s=xe;return x(),g("div",me,[pe,m("div",ge,[m("button",{btn:"~ sky",onClick:l[0]||(l[0]=(...r)=>c(e)&&c(e)(...r))}," New Game ")]),ie(s,{state:c(n),onReset:c(e)},null,8,["state","onReset"])])}}});typeof O=="function"&&O(_e);export{_e as default};
